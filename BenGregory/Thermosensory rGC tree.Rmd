---
title: Cross-clade thermosensory receptor guanlyate cyclase phylogenetic analysis 
output: html_notebook
---

```{r}
setRepositories(ind = c(1,2,3,4,5,6))
libPath <- .libPaths()
if (!requireNamespace("pacman", quietly = TRUE))
    install.packages("pacman")
library(pacman)
pacman::p_load(ape, tidyverse,treeio,magrittr,rcartocolor,Cairo)

if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
library(BiocManager)
BiocManager::install("ggtree, ask=FALSE")
BiocManager::install("ggexpand, ask=FALSE")
```

```{r}
library(ape)
library(tidyverse)
library(ggtree)
#library(ggexpand)
library(treeio)
library(magrittr)
library(rcartocolor)
library(Cairo)
```

## Import Treefile generated by IQ-Tree
```{r}
treefile <- file.choose()
tree <- read.iqtree(treefile)
tree_tbl <- as_tibble(tree)
```


## Code here to define sequence groups that will be colored differently (optional)
```{r}
Clade5_nodes <- dplyr::filter(tree_tbl, grepl('Acey|ANCCAN|NAME|HCON|HPOL',label))

Clade4_nodes <- dplyr::filter(tree_tbl, grepl('SRAE|SSTP|Ss|Sr|L596|RSKR',label))
Clade3_nodes <- dplyr::filter(tree_tbl, grepl('EN70|DINM|AgR006|ALUE',label))

Str_nodes <- dplyr::filter(tree_tbl, grepl('SRAE|SSTP|Ss|Sr',label))
Ce_nodes <- dplyr::filter(tree_tbl, grepl('Ce|DAF',label))

grp <- list (Clade3 = Clade3_nodes$node,
             Clade4 = Clade4_nodes$node,
             Clade5 = Clade5_nodes$node,
             Elegans = Ce_nodes$node,
             Strongyloides = Str_nodes$node
             )

speciescolors <- c("Elegans" = "olivedrab", 
                   "Strongyloides" = "coral",
                   "Clade3" = "darkorchid",
                   "Clade4" = "royalblue",
                   "Clade5" = "palevioletred" 
                   )
```

## Plot a tree without colors
```{r}
p <- ggtree(tree, layout = "fan") +
    geom_tiplab(size = 2, hjust = -.05) + 
    #geom_cladelabel(node = 134, label = "AFD-specific rGCs", align = T, offset = 1.2,
     #               offset.text = .3, barsize = 1, angle = -4,
      #              hjust = 'center', fontsize = 3) +
    #geom_hilight(node=86, fill="grey", alpha=.5, extend = 3) +
    xlim(0, 6)

p
```

## Plot a tree with color groupings
```{r}
p2 <- groupOTU(p, grp, 'Species') + aes(color = Species) +
    scale_color_manual(values = speciescolors)
p2
```

## Save plot as PDF
```{r}
ggsave(plot = p2,
       filename ="rGC_tree_fan.pdf",
       device = cairo_pdf,
       height = 8)

```
    

